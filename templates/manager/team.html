{% extends 'manager/base.html' %}
{% block title %}隊伍管理{% endblock title %}
{% block actions %}
<button class="btn btn-primary add-staff-btn" data-bs-toggle="modal" data-bs-target="#staff-manager-modal">
    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
    Add team
</button>
<label class="form-selectgroup-item">
    <input type="checkbox" id="view-all" class="form-selectgroup-input">
    <span class="form-selectgroup-label">顯示已停用的隊伍</span>
</label>
{% endblock actions %}
{% block content %}
<div class="card">
    <div class="table-responsive mb-0">
        <table class="table card-table table-vcenter" id="main-table">
            <thead>
                <tr>
                    <th>隊伍</th>
                    <th>成員</th>
                    <th>狀態</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for t in teams %}
                <tr>
                    <td>
                        <div class="d-flex align-items-center">
                            <span class="avatar me-2" style="background-image: url({{ t.flag_name | flag_url }});"></span>
                            <div class="flex-fill">
                                <div class="font-weight-medium">{{ t.full_name }}</div>
                                <div class="text-muted">{{ t.acronym }}</div>
                            </div>
                        </div>
                    </td>
                    <td class="w-50">
                        {% if t.players %}
                        {% for p in t.players %}
                        <a class="avatar" style="background-image: url(https://a.ppy.sh/{{p.user_id}})" href="https://osu.ppy.sh/u/{{p.user_id}}" target="_blank" data-bs-toggle="tooltip" data-bs-placement="top" title="{{p.username}}"></a>
                        {% endfor %}
                        {% endif %}
                    </td>
                    <td>
                        <span class="text-green">PASS</span>
                    </td>
                    <td>
                        <div class="text-end">
                            <button type="button" class="btn dropdown-toggle align-text-top" id="menu" data-bs-toggle="dropdown" aria-expanded="false">
                                <span>
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                        class="icon icon-tabler icon-tabler-adjustments-horizontal" width="44" height="44"
                                        viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none"
                                        stroke-linecap="round" stroke-linejoin="round">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                        <circle cx="14" cy="6" r="2" />
                                        <line x1="4" y1="6" x2="12" y2="6" />
                                        <line x1="16" y1="6" x2="20" y2="6" />
                                        <circle cx="8" cy="12" r="2" />
                                        <line x1="4" y1="12" x2="6" y2="12" />
                                        <line x1="10" y1="12" x2="20" y2="12" />
                                        <circle cx="17" cy="18" r="2" />
                                        <line x1="4" y1="18" x2="15" y2="18" />
                                        <line x1="19" y1="18" x2="20" y2="18" />
                                    </svg>
                                </span>
                                <span>
                                    選項
                                </span>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="menu">
                                <li>
                                    <button class="dropdown-item" data-bs-toggle="modal" data-bs-target="#update-modal" data-id="{{ t.id }}">編輯</button>
                                </li>
                                <li>
                                    <button class="dropdown-item text-danger" data-bs-toggle="modal" data-bs-target="#del-modal" data-id="{{ t.id }}">停用</button>
                                </li>
                            </ul>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
<div class="modal modal-blur fade" id="update-modal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">修改 Team</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form action="" method="post" id="update-form" autocomplete="off">
                    <input type="hidden" name="id" id="u-id">
                    <div class="mb-3">
                        <label class="form-label required">隊伍全名</label>
                        <input type="text" class="form-control" id="u-fullname" name="full_name" maxlength="50" placeholder="full_name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">隊名縮寫</label>         
                        <input type="text" class="form-control" id="u-acronym" name="acronym" maxlength="4" placeholder="(可選) 最多4字">
                    </div>                                                                                                                                                                                                                                                                                            
                    <div class="mb-3">
                        <label class="form-label required">旗幟/頭像</label>
                        <input type="text" class="form-control" id="u-flagname" name="flag_name"  required>
                    </div>
                    <div id="spinner" style="display: none;">
                        <div class="spinner-border" role="status"></div>Loading...
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="reset" form="update-round-form" class="btn me-auto" data-bs-dismiss="modal">取消</button>
                <button type="submit" form="update-round-form" class="btn btn-primary">修改</button>
            </div>
        </div>
    </div>
</div>
<div class="modal modal-blur fade" id="del-modal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            <div class="modal-status bg-danger"></div>
            <div class="modal-body text-center py-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-alert-triangle mb-2 text-danger icon-lg" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                    <path d="M12 9v2m0 4v.01" />
                    <path d="M5 19h14a2 2 0 0 0 1.84 -2.75l-7.1 -12.25a2 2 0 0 0 -3.5 0l-7.1 12.25a2 2 0 0 0 1.75 2.75" />
                </svg>
                <h3>Are you sure?</h3>
                <div class="text-muted">
                    你確定要刪除 <span id="del-name"></span> (ID:<span id="del-id"></span>) 嗎?<br>
                    確認之後將無法復原!
                </div>
                <form action="" method="post" id="del-form"></form>
            </div>
            <div class="modal-footer">
                <div class="w-100">
                    <div class="row">
                        <div class="col">
                            <button type="button" class="btn btn-white w-100" data-bs-dismiss="modal">取消</button>
                        </div>
                        <div class="col">
                            <button type="submit" id="del-submit" form="del-round-form" class="btn btn-danger w-100" disabled>確認刪除</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}
{% block script %}
<script>
    {{teams | tojson}}
</script>
{% endblock script %}